services:
  postgres:
    image: postgres:16
    restart: unless-stopped
    environment:
      POSTGRES_USER: n8n
      POSTGRES_PASSWORD: n8npass
      POSTGRES_DB: n8n
      TZ: Asia/Jakarta
    volumes:
      - postgres_data:/var/lib/postgresql/data

  n8n:
    image: n8nio/n8n:latest
    restart: unless-stopped
    depends_on:
      - postgres
    ports:
      - "5678:5678"
    environment:
      # --- Security / Auth ---
      N8N_BASIC_AUTH_ACTIVE: "true"
      N8N_BASIC_AUTH_USER: "admin"
      N8N_BASIC_AUTH_PASSWORD: "patriacon8n"

      # --- Timezone ---
      TZ: "Asia/Jakarta"

      # --- Database ---
      DB_TYPE: "postgresdb"
      DB_POSTGRESDB_HOST: "postgres"
      DB_POSTGRESDB_PORT: "5432"
      DB_POSTGRESDB_DATABASE: "n8n"
      DB_POSTGRESDB_USER: "n8n"
      DB_POSTGRESDB_PASSWORD: "n8npass"

      # --- Encryption key (untuk credentials) ---
      N8N_ENCRYPTION_KEY: "${N8N_ENCRYPTION_KEY}"

      # --- External URL (untuk webhook/AI webhooks) ---
      # Ganti dengan domain publik atau tunnel URL localhost
      WEBHOOK_URL: "http://localhost:5678/"

      # Optional: matikan telemetry
      N8N_DIAGNOSTICS_ENABLED: "false"
      N8N_PERSONALIZATION_ENABLED: "false"

    volumes:
      - n8n_data:/home/node/.n8n

volumes:
  n8n_data:
  postgres_data:

## cara running
##1. Pindah ke folder project
# cd /mnt/e/Work/Patria&Co/AI_Agent/n8n_automation/local_setup

##2. Generate key random 32-byte hex
#openssl rand -hex 32 > .encryption_key

##3. Pastikan file ada
# ls -l .encryption_key

##. up docker compose
# docker compose up -d
# docker compose ps